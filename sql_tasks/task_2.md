## Реализовать календарь на весь 2024 в таком виде на PostgreSQL

| WEEK_NUM | MON_DATE_START | SUN_DATE_END | YEAR |
|----------|----------------|--------------|------|
| 1        | 01.01.2024     | 07.01.2024   | 2024 |
| 2        | 08.01.2024     | 14.01.2024   | 2024 |
| 3        | 15.01.2024     | 21.01.2024   | 2024 |
| 4        | 22.01.2024     | 28.01.2024   | 2024 |
| 5        | 29.01.2024     | 04.02.2024   | 2024 |
| 1        | 05.02.2024     | 11.02.2024   | 2024 |

### Выполнение

```sql
-- Используем рекурсию для создания последовательность дат, 
-- а затем агрегируем их по неделям, определяя начало и конец для каждой недели в формате 'DATE'
WITH RECURSIVE dates AS (
    SELECT '2024-01-01'::DATE AS date
    UNION ALL
    SELECT date + 1
    FROM dates
    WHERE date < '2024-12-31'
),
weeks AS (
    SELECT
        date,
        EXTRACT(ISODOW FROM date) AS isodow,
        EXTRACT(ISOYEAR FROM date) AS isoyear, -- Используем ISOYEAR для определения года, чтобы правильно обработать переходы между годами
        EXTRACT(WEEK FROM date) AS week_num -- Используем WEEK для определения номера недели в году по ISO стандарту
    FROM dates
),
aggregated_weeks AS (
    SELECT
        week_num,
        MIN(date) FILTER (WHERE isodow = 1) AS mon_date_start, -- Понедельник как начало недели
        CASE
            WHEN COUNT(*) = 7 THEN MAX(date) -- Конец недели, если в неделе 7 дней
            ELSE NULL -- В противном случае, конец недели не определяется
        END AS sun_date_end,
        MAX(isoyear) AS year
    FROM weeks
    GROUP BY week_num, isoyear
    HAVING MAX(isoyear) = 2024 -- Убедимся, что учитываем только недели, полностью приходящиеся на 2024 год
),
last_week_correction AS (
    SELECT
        53 AS week_num,
        DATE '2024-12-30' AS mon_date_start, -- Последняя неделя начинается здесь
        NULL::DATE AS sun_date_end, -- Конец недели не определен, так как выходит за рамки 2024 года
        2024 AS year
    WHERE NOT EXISTS (
        SELECT 1 FROM aggregated_weeks WHERE week_num = 53 AND year = 2024
    ) -- Добавляем 53-ю неделю, только если она не была сформирована автоматически
)
SELECT
    week_num,
    mon_date_start,
    sun_date_end,
    year
FROM aggregated_weeks
UNION ALL
SELECT
    week_num,
    mon_date_start,
    sun_date_end,
    year
FROM last_week_correction
ORDER BY mon_date_start;
```

#### результат выполнения 

| week_num | mon_date_start | sun_date_end  | year  |
|:---------|:---------------|:--------------|:------|
| 1        | 2024-01-01     | 2024-01-07    | 2024  |
| 2        | 2024-01-08     | 2024-01-14    | 2024  |
| 3        | 2024-01-15     | 2024-01-21    | 2024  |
| 4        | 2024-01-22     | 2024-01-28    | 2024  |
| 5        | 2024-01-29     | 2024-02-04    | 2024  |
| 6        | 2024-02-05     | 2024-02-11    | 2024  |
| 7        | 2024-02-12     | 2024-02-18    | 2024  |
| 8        | 2024-02-19     | 2024-02-25    | 2024  |
| 9        | 2024-02-26     | 2024-03-03    | 2024  |
| 10       | 2024-03-04     | 2024-03-10    | 2024  |
| 11       | 2024-03-11     | 2024-03-17    | 2024  |
| 12       | 2024-03-18     | 2024-03-24    | 2024  |
| 13       | 2024-03-25     | 2024-03-31    | 2024  |
| 14       | 2024-04-01     | 2024-04-07    | 2024  |
| 15       | 2024-04-08     | 2024-04-14    | 2024  |
| 16       | 2024-04-15     | 2024-04-21    | 2024  |
| 17       | 2024-04-22     | 2024-04-28    | 2024  |
| 18       | 2024-04-29     | 2024-05-05    | 2024  |
| 19       | 2024-05-06     | 2024-05-12    | 2024  |
| 20       | 2024-05-13     | 2024-05-19    | 2024  |
| 21       | 2024-05-20     | 2024-05-26    | 2024  |
| 22       | 2024-05-27     | 2024-06-02    | 2024  |
| 23       | 2024-06-03     | 2024-06-09    | 2024  |
| 24       | 2024-06-10     | 2024-06-16    | 2024  |
| 25       | 2024-06-17     | 2024-06-23    | 2024  |
| 26       | 2024-06-24     | 2024-06-30    | 2024  |
| 27       | 2024-07-01     | 2024-07-07    | 2024  |
| 28       | 2024-07-08     | 2024-07-14    | 2024  |
| 29       | 2024-07-15     | 2024-07-21    | 2024  |
| 30       | 2024-07-22     | 2024-07-28    | 2024  |
| 31       | 2024-07-29     | 2024-08-04    | 2024  |
| 32       | 2024-08-05     | 2024-08-11    | 2024  |
| 33       | 2024-08-12     | 2024-08-18    | 2024  |
| 34       | 2024-08-19     | 2024-08-25    | 2024  |
| 35       | 2024-08-26     | 2024-09-01    | 2024  |
| 36       | 2024-09-02     | 2024-09-08    | 2024  |
| 37       | 2024-09-09     | 2024-09-15    | 2024  |
| 38       | 2024-09-16     | 2024-09-22    | 2024  |
| 39       | 2024-09-23     | 2024-09-29    | 2024  |
| 40       | 2024-09-30     | 2024-10-06    | 2024  |
| 41       | 2024-10-07     | 2024-10-13    | 2024  |
| 42       | 2024-10-14     | 2024-10-20    | 2024  |
| 43       | 2024-10-21     | 2024-10-27    | 2024  |
| 44       | 2024-10-28     | 2024-11-03    | 2024  |
| 45       | 2024-11-04     | 2024-11-10    | 2024  |
| 46       | 2024-11-11     | 2024-11-17    | 2024  |
| 47       | 2024-11-18     | 2024-11-24    | 2024  |
| 48       | 2024-11-25     | 2024-12-01    | 2024  |
| 49       | 2024-12-02     | 2024-12-08    | 2024  |
| 50       | 2024-12-09     | 2024-12-15    | 2024  |
| 51       | 2024-12-16     | 2024-12-22    | 2024  |
| 52       | 2024-12-23     | 2024-12-29    | 2024  |
| 53       | 2024-12-30     | NULL          | 2024  |
